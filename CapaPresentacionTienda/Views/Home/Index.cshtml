@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<br />
<main>
    <div class="row justify-content-center">

        <div id="myCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>

            <div class="carousel-inner">
                <!-- Primera imagen -->
                <div class="carousel-item active">
                    <img src="~/Content/imag/hamburguesa_1.jpg" alt="cafe" />
                    <div class="container-carusel">
                        <div class="carousel-caption text-start">
                            <h5></h5>
                            <p></p>
                            <!-- Agrega un botón si es necesario -->
                            <!-- <p><a class="btn btn-gradient rounded-pill px-5 py-2 shadow" href="#">Ver Más</a></p> -->
                        </div>
                    </div>
                </div>

                <!-- Segunda imagen -->
                <div class="carousel-item">
                    <img src="~/Content/imag/hamburguesa_2.jpg" alt="sorve" />
                    <div class="container-carusel">
                        <div class="carousel-caption">
                            <h5></h5>
                            <p></p>
                            <!-- Agrega un botón si es necesario -->
                            <!-- <p><a class="btn btn-gradient rounded-pill px-5 py-2 shadow" href="#">Ver Más</a></p> -->
                        </div>
                    </div>
                </div>

                <!-- Tercera imagen -->
                <div class="carousel-item">
                    <img src="~/Content/imag/hamburguesa_3.jpg" alt="sorve" />
                    <div class="container-carusel">
                        <div class="carousel-caption text-end">
                            <h5></h5>
                            <p></p>
                            <!-- Agrega un botón si es necesario -->
                            <!-- <p><a class="btn btn-gradient rounded-pill px-5 py-2 shadow" href="#">Ver Más</a></p> -->
                        </div>
                    </div>
                </div>
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>


    </div>
    <br />
    <br />
    <section class="mx-auto">
        <!-- Barra de búsqueda -->
        <div class="search-container text-center mb-4">
            <form class="d-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Buscar productos..." aria-label="Buscar productos..." aria-describedby="btnNavbarSearch" />
                    <button class="btn btn-primary" id="btnNavbarSearch" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Botones de categorías como enlaces de ancla -->
        <div class="container">
            <!-- Contenedor para las categorías -->
            <div id="contenedor_categoria" class="mb-4">
                <h2 class="fw-bold">Categorías</h2>
                <!-- Las categorías se agregarán dinámicamente aquí -->
            </div>

            <!-- Contenedor para productos agrupados por categorías -->
            <div id="contenedor_secciones_producto">
                <!-- Las secciones de productos por categoría se agregarán dinámicamente aquí -->
            </div>
        </div>

    </section>


</main>

@section scripts{

    <script>

        //funciona todo ahora voy por reparar detalle
        $(document).ready(function() {
            MostrarCategoria();
        });

        function MostrarCategoria() {
            jQuery.ajax({
                url: '@Url.Action("ListaCategorias", "Home")',
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(response) {
                    $("#contenedor_categoria").LoadingOverlay("hide");
                    $("#contenedor_categoria").empty();  // Limpiar el contenedor de categorías

                    // Generar enlaces de categorías
                    $.each(response.data, function(i, element) {
                        $("<a>")
                            .addClass("btn btn-outline-primary m-1")
                            .text(element.Nombre)
                            .attr("href", "#categoria_" + element.Id_Categoria)
                            .on("click", function(e) {
                                e.preventDefault();
                                MostrarProductoporCategoria(element.Id_Categoria);
                            })
                            .appendTo("#contenedor_categoria");
                    });

                    // Mostrar todos los productos en secciones al cargar
                    MostrarProductoporCategoria();
                },
                beforeSend: function() {
                    $("#contenedor_categoria").LoadingOverlay("show");
                }
            });
        }

        function MostrarProductoporCategoria(idCategoria = 0) {
            jQuery.ajax({
                url: '@Url.Action("ListarProductoporCategorias", "Home")',
                type: "POST",
                data: JSON.stringify({ idcategoria: idCategoria }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(response) {
                    $("#contenedor_secciones_producto").LoadingOverlay("hide");
                    $("#contenedor_secciones_producto").html("");  // Limpiar antes de agregar nuevos productos

                    // Verificar si hay productos para mostrar
                    if (response.data.length > 0) {
                        let currentCategory = null;
                        let sectionContainer = null;

                        // Iterar sobre productos para agruparlos por categoría
                        $.each(response.data, function(i, element) {
                            // Si cambia de categoría, crear nueva sección
                            if (currentCategory !== element.Nombre_Categoria) {
                                currentCategory = element.Nombre_Categoria;
                                sectionContainer = $("<div>").attr("id", "categoria_" + element.Id_Categoria)
                                    .addClass("mb-5")
                                    .append($("<h3>").addClass("fw-bold").text(currentCategory));

                                // Agregar la nueva sección al contenedor principal
                                sectionContainer.appendTo("#contenedor_secciones_producto");
                            }

                            // Crear tarjeta de producto
                            $("<div>").addClass("card h-100 mb-4")
                                .append(
                                    $("<img>").addClass("card-img-top").attr("src", element.Ruta_Imagen),
                                    $("<div>").addClass("card-body p-4").append(
                                        $("<div>").addClass("text-center").append(
                                            $("<h5>").addClass("fw-bolder").text(element.Nombre),
                                            "$" + element.Precio.toFixed(2) + " PESO"
                                        )
                                    ),
                                    $("<div>").addClass("card-footer p-2 pt-0 border-top-0 bg-transparent").append(
                                        $("<div>").addClass("d-grid gap-2").append(
                                            $("<button>").addClass("btn btn-success mt-auto agrearcarrito")
                                                .data("idproducto", element.Id_Producto)
                                                .text("Agregar a carrito"),
                                            $("<a>").addClass("btn btn-dark mt-auto")
                                                .attr({"href": '@Url.Action("DetalleProducto","Home")' + "?idproducto=" + element.Id_Producto})
                                                .text("Ver detalle")
                                        )
                                    )
                                ).appendTo(sectionContainer);  // Añadir producto a la sección de la categoría actual
                        });
                    } else {
                        $("<div>").addClass("alert alert-warning")
                            .text("No hay productos disponibles para esta categoría.")
                            .appendTo("#contenedor_secciones_producto");
                    }
                },
                beforeSend: function() {
                    $("#contenedor_secciones_producto").LoadingOverlay("show");
                }
            });
        }



    </script>
}

<!-- Footer-->
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>

